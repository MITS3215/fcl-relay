name: relay-cron
on:
  schedule:
    # JST=UTC+9
    - cron: "0 1 * * *"    # 10:00
    - cron: "15 1 * * *"   # 10:15 フォールバック
    - cron: "0 8 * * *"    # 17:00
    - cron: "15 8 * * *"   # 17:15 フォールバック
    - cron: "0 12 * * *"   # 21:00
    - cron: "15 12 * * *"  # 21:15 フォールバック
  workflow_dispatch:

concurrency:
  group: relay-cron
  cancel-in-progress: true

jobs:
  relay:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install deps
        run: |
          python -m pip install -U pip
          pip install -U discord.py aiohttp

      - name: Run relay
        env:
          DISCORD_BOT_TOKEN: ${{ secrets.DISCORD_BOT_TOKEN }}
          GUILD_ID: ${{ secrets.GUILD_ID }}
          INBOX_CHANNEL_ID: ${{ secrets.INBOX_CHANNEL_ID }}
          CH_NEWS_ID: ${{ secrets.CH_NEWS_ID }}
          CH_EVENT_ID: ${{ secrets.CH_EVENT_ID }}
          CH_SEMINAR_ID: ${{ secrets.CH_SEMINAR_ID }}
          CH_TIPS_ID: ${{ secrets.CH_TIPS_ID }}
          LOOKBACK_HOURS: "12"
        run: python scan_and_relay.py
